{{% BLOCKS }}
{{< layout }}{>}
	{{$ title }}{{page.title}}{{/ title }}

	{{$ stylesheets }}
	{{/ stylesheets }}

	{{$ more_scripts }}
	{{/ more_scripts }}

	{{$ autoload_scripts }}
	{{/ autoload_scripts }}

	{{$ content }}
	<!-- PROFILE EDIT MODAL -->
	<div id="profile_edit_modal" class="modal hide fade" tabindex="-1" role="dialog"  aria-labelledby="blogPostLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
			<b>Basic Info</b>  
		</div>
		<div class="modal-body">
			<label class="label label-success hide" id="basic_info_update_success_txt">Information successfully updated!</label>
			<label class="label label-important hide" id="basic_info_update_failure_txt">Update failed. Please try again.</label>
			<form id="basic_info_form">
				<table class="profile dashboard">
				<thead></thead>
				<tfoot><tfoot>
				<tbody>
					<input type="hidden" name="bi_update" value="1"/>
					<tr class="dashboard">
						<!--<td class="dashboard"><h3 class="dashboard">First Name:</h3></td>-->
						<td class="dashboard"><input class="dashboard" type="text" name="first_name" value="{{ user.first_name }}" placeholder="First Name"></td>
					</tr>
					<tr class="dashboard">
						<!--<td class="dashboard"><h3 class="dashboard">Last Name:</h3></td>-->
						<td class="dashboard"><input class="dashboard" type="text" name="last_name" value="{{ user.last_name }}" placeholder="Last Name"></td>
					</tr>
					<tr class="dashboard">
						<!--<td class="dashboard"><h3 class="dashboard">Gender:</h3></td>-->
						<td class="dashboard">
						
						    <select class="dashboard" name="gender">
						        <option {{# user.male }}selected{{/ user.male }}>Male</option>
							<option {{# user.female }}selected{{/ user.female }}>Female</option>
						    </select>
						</td>
					</tr>
					<tr class="dashboard">
						<!--<td class="dashboard"><h3 class="dashboard">About Me:</h3></td>-->
						<td class="dashboard"><textarea class="dashboard" name="about_me" placeholder="Tell us about yourself...">{{ user.about_me }}</textarea></td>
					</tr>
				</tbody>
				</table>
				<a class="btn cm-button btn-green dash" id="basic_info_update_btn">Update</a>
			</form>
		</div>
		<div class="modal-footer">
		</div>
	</div>
	{{^ page_vars.guest }}
	{{^ user.confirmed }}
	<div id="confirmation_panel">
		<p>An confirmation email has been sent to you.</p>
		<p>Please respond so that you can enjoy full access to CultureMesh</p>
		<p>If you need another confirmation email, <a href="#" onclick="resendEmail({{ page_vars.uid }})">click here</a></p>
		<p id="confirm_txt" style="display:none;">Confirmation sent</p>
	</div>
	{{/ user.confirmed }}
	{{/ page_vars.guest }}

	<!-- PROFILE LEFT PANEL -->
	<div class="profile_left_panel">
	    <span class="profile_image">
		    <img id="profile_image" class='usr_image' src="{{ vars.img_host_repo }}{{ user.img_link }}#{{ page_vars.rand }}"/>
	    </span>
	    <div id="pic-upload-div">
		    <p id="success-label"></p>
		    <form id="profile-pic-upload" method="POST" action="{{ vars.home_path }}/profile_img_upload.php" enctype="multipart/form-data"/>
			<input type="file" id="upload-input" name="picfile">
			<input type="hidden" id="upload-id" name="id" value="{{ page_vars.uid }}">
			<noscript>
				<input type="submit" value="Upload File">
				<input type="hidden" name="ajax-enabled" value="false">
			</noscript>
		    </form>
	    </div>
	    </br>
	    <span class="profile_name">
		    <h2 id="profile_name" class="dashboard">{{ user.first_name }} {{ user.last_name }}</h2>
		<p id="profile_about" class="profile">{{ user.about_me }}</p>
	    </span>
	{{^ page_vars.guest }}
	    <p class="profile"><a href="#profile_edit_modal" class="profile" id="pro-edit-link" data-toggle="modal">Edit Profile</a></p>
	    {{# user.confirmed }}
	    <p class="profile"><a data-toggle="modal" href="#password_confirm_modal">Change Password</a></p>
	    {{/ user.confirmed }}
	    <p class="profile"><a id="pic-upload-toggle" href="#">Upload Picture</a></p>
	{{/ page_vars.guest }}
	</div>

	<!-- PROFILE DASHBOARD -->
	<div class="profile_dashboard">
	{{{ sections.searchbar }}}
	    <ul class="nav nav-pills dashboard">
	<!--        <li class="active"><a href="#profile_basic_info_tab" data-toggle="pill">Basic Info</a></li>-->
		<li class="active"><a href="#profile_dashboard_tab" data-toggle="pill">Dashboard</a></li>
		<li><a href="#profile_networks_tab" data-toggle="pill">Networks</a></li>
		<li><a href="#profile_events_tab" data-toggle="pill">Events</a></li>
	<!--        <li><a href="#profile_inbox_tab" data-toggle="pill">Inbox</a></li>-->
	{{^ page_vars.guest }}<li><a href="#profile_accounts_tab" data-toggle="pill">Account</a></li>{{/ page_vars.guest }}
	    </ul>
	    <div class="tab-content">
	<!--        <div class="tab-pane" id="profile_basic_info_tab">
		</div>-->
		<!-- DASHBOARD TAB -->
		<div class="tab-pane active" id="profile_dashboard_tab">
			<div>
				<h5><b>EVENTS YOU'RE HOSTING</b></h5>
				<ul class="dashboard item">
				{{# sections.yh_events }}
				{{{ . }}}
				{{/ sections.yh_events }}
				</ul>
			</div>
			<div>
				<h5><b>EVENTS IN YOUR NETWORKS</b></h5>
				{{{ sections.yn_events }}}
			</div>
			<div>
				<h5><b>YOUR POSTS</b></h5>
				{{# sections.yp_posts }}
				{{{ . }}}
				{{/ sections.yp_posts }}
				{{$ page_vars.yp_count }}
				<form id='more-posts' action='{{ vars.home_path }}/profile_operations.php' method='POST' />
					<input type='hidden' name='more_posts' value='true' />
					<input type='hidden' name='uid' value='{{ user.id }}' />
					<input type='hidden' id='lb' name='lb' value='10' />
					<input type='hidden' id='nid' name='nid' value='{{ page_vars.lastpost_nid }}' />
					<button id="mp_button" class="post show">Load More Posts</button>
				</form>
				{{/ page_vars.yp_count }}
			</div>
		</div>
		<!-- NETWORKS TAB -->
		<div class="tab-pane" id="profile_networks_tab">
			<div>
				<h5>Your Networks</h5>
				<ul class="dashboard item">
				{{# sections.yn_networks }}
				{{{ . }}}
				{{/ sections.yn_networks  }}
				</ul>
			</div>
		</div>
		<!-- EVENTS TAB -->
		<div class="tab-pane" id="profile_events_tab">
			<div>
				<h5>EVENTS YOU'RE HOSTING</h5>
				<ul class='dashboard item'>
					{{# sections.yh_events }}
					{{{ . }}}
					{{/ sections.yh_events }}
				</ul>
			</div>
			<div>
				<h5>EVENTS YOU'RE ATTENDING</h5>
				<ul class='dashboard item'>
					{{# sections.ya_events }}
					{{{ . }}}
					{{/ sections.ya_events }}
				</ul>
			</div>
		</div>
	<!--        <div class="tab-pane" id="profile_inbox_tab">
		</div>-->
		<!-- ACCOUNTS TAB -->
		{{^ page_vars.guest }}
		<div class="tab-pane" id="profile_accounts_tab">
			<form id="account_info_form" method="POST" action="{{ vars.home_path }}/update_notifications.php">
				<div>
					<label class="label label-success hide" id="account_info_update_success_txt">Information successfully updated!</label>
					<label class="label label-important hide" id="account_info_update_failure_txt">Update failed. Please try again.</label>
					<h5>Send me emails when</h5>
					<label class="checkbox"><input type="checkbox" name="notify_interesting_events" value="1" {{# user.interesting_events }}checked{{/ user.interesting_events }}>CultureMesh finds events I'd be interested in near me</label>
					<label class="checkbox"><input type="checkbox" name="notify_company_news" value="1" {{# user.company_news }}checked{{/ user.company_news }}>CultureMesh has fun company news</label>
					<label class="checkbox"><input type="checkbox" name="notify_events_upcoming" value="1" {{# user.events_upcoming }}checked{{/ user.events_upcoming }}>I have an upcoming event</label>
					<label class="checkbox"><input type="checkbox" name="notify_network_activity" value="1" {{# user.events_upcoming }}checked{{/ user.events_upcoming }}>I have received comments to a network event I added</label>
					<input type="hidden" name="notification" value="yes"/>
				</div>
				{{# user.confirmed }}
				<div id="account-buttons">
					<!--<input type="submit" class="btn cm-button btn-gray dash" value="Cancel"\>-->
					<input type="submit" class="btn cm-button btn-green dash" value="Submit"\>
				</div>
				{{/ user.confirmed }}
				{{^ user.confirmed }}
				<div>
					<p>You must confirm your email to submit these changes.</p>
				</div>
				{{/ user.confirmed }}
			</form>
		</div>
		{{/ page_vars.guest }}
	    </div>
	</div>
	<div class="clear"></div>
	{{/ content }}

	{{$ body_scripts }}
	<script src="{{vars.home_path}}/js/searchbar.js"></script>

	<script>
		// necessary for some reason
		$('#lb').val(10);

		// more posts form submit event
		$('#more-posts').on('submit', function(e) {
			// prevent form submission
			e.preventDefault();
		
			var postForm = $( e.target ).serialize();

			var ajaxRequest = new Ajax({
					requestType: 'POST',
					requestUrl: '{{ vars.home_path }}/profile_operations.php',
					requestHeaders: ' ',
					data: postForm,
					dataType: 'string',
					sendNow: true
				}, function(data) {
					var response = JSON.parse(data);

					if (response['error'] == 'success') {
						// stuff
						$('#your-posts').append(response['html']);

						if (response['continue'] == 'y') {
							$('#lb').val(response['lb']);
						}
						else {
							$('#mp_button').hide();
						}
					}
				}, function() {
				});
		});

	</script>

	{{/ body_scripts }}

{{/ layout }}
