{{% BLOCKS }}
<!DOCTYPE html>
<html>
	<head>
		<title>{{$ title }}CultureMesh - Connecting the World's Diasporas {{/ title }}</title>
		<meta charset="utf-8"/>
		<meta name="keywords" content="" />
		<meta name="description" content="Welcome to CultureMesh - Connecting the world's diasporas!" />

		<!-- Facebook analytics stuff -->
		<meta name="og:title" content="CultureMesh" />
		<meta name="og:site_name" content="CultureMesh" />
		<meta name="og:url" content="http://culturemesh.com"/>
		<meta name="og:description" content="Connecting the World's Diasporas" />
		<meta name="og:image" content="http://www.culturemesh.com/culturemesh-live/htdocs/images/CM_Logo_Final_square.jpg"/>

		<script src="{{ vars.hostname }}/js/utilities.js"></script>
		<script type="text/javascript">
			cm.home_path = "{{ vars.hostname }}";
		</script>

		<!--
		<link href="{{ vars.hostname }}/css/bootstrap.css" rel="stylesheet">
		-->
		<link href="{{ vars.hostname }}/bootstrap-3.3.6/css/bootstrap.css" rel="stylesheet">
		<link href="{{ vars.hostname }}/css/bootstrap.css" rel="stylesheet">
		<link href="{{ vars.hostname }}/css/style.css#" rel="stylesheet">
		{{$ stylesheets }}
		{{/ stylesheets }}

		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>
		<script src="{{ vars.hostname }}/js/parsley.min.js"></script>

		<script src="{{ vars.hostname }}/js/jquery-ui.js"></script>
		<!--
		<script src="{{ vars.hostname }}/js/bootstrap.js"></script>
		-->
		<script src="{{ vars.hostname }}/bootstrap-3.3.6/js/bootstrap.js"></script>
		<script src="{{ vars.hostname }}/js/validation.js"></script>
		<script src="{{ vars.hostname }}/js/account.js"></script>
		<script src="{{ vars.hostname }}/js/autoloader.js"></script>
		<script src="{{ vars.hostname }}/js/fxn.js"></script>
		<script src="{{ vars.hostname }}/js/ajax.js"></script>
		<script src="{{ vars.hostname }}/js/mustache.js/mustache.js"></script>
		<script src="{{ vars.hostname }}/js/utilities.js"></script>

		<script>
			window.fbAsyncInit = function() {
				  FB.init({
				    appId      : '670914089652347',
				    status     : true,
				    xfbml      : true,
				    version    : 'v2.0'
				  });
			}

			(function(d, s, id) {
			  var js, fjs = d.getElementsByTagName(s)[0];
			  if (d.getElementById(id)) return;
			  js = d.createElement(s); js.id = id;
			  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.0";
			  fjs.parentNode.insertBefore(js, fjs);
			}(document, 'script', 'facebook-jssdk'));
		</script>
		<script src="https://apis.google.com/js/plusone.js"></script>

		<script type="text/javascript">
		/*
			* Goto function
		 */
		(function($) {
		    $.fn.goTo = function() {
			$('html, body').animate({
			    scrollTop: $(this).offset().top + 'px'
			}, 'fast');
			return this; // for chaining...
		    }
		})(jQuery);

		/*
			* Query string parser
		 */
		function QueryStringParser() {

			this.length = 0;
			this.qsGet = null;
			this.fragment = null;

			// get query string
			var qs = window.location.search.substring(1).split('?')[0];
			this.fragment = window.location.hash;

			// split into array of key value pairs
			if (qs.length == 0) {
				this.length = 0;
			}
			else {
				// initialize qsGET
				this.qsGet = {};

				// split qs again in case of multiple params
				qs = qs.split('&');

				// for each  param, 
				// 	- split into key, value
				// 	- add to qsGET
				var param;
				for (var i = 0; i < qs.length; i++) {
					// split into two values
					param = qs[i].split('=');

					// add to object
					this.qsGet[param[0]] = decodeURIComponent(param[1]);
				}
			}
		}

		QueryStringParser.prototype.getQSObject = function() {
			return this.qsGet;
		}


		// HEIGHT ADJUSTMENT FOR MODALS
		$('#register_modal,#login_modal').each(function() {
			$( this ).on('shown', function () {
				$('.modal .modal-body').css('overflow-y', 'auto'); 
				$('.modal .modal-body').css('max-height', $(window).height() * 0.7);
			})
		});
		</script>


		{{$ more_scripts }}
		{{/ more_scripts }}

		{{$ autoload_scripts }}
		{{/ autoload_scripts }}
	</head>
	<body>

		<div class="wrapper container">
			<div id="header" class="row">
				<div id="top-logo" class="col-lg-4 col-md-4">
					<a href="{{ vars.hostname }}/index.php"><img src="{{ vars.hostname }}/images/logo_header.png"></a>
				</div>
				<div id="right-top-btns" class="hidden-sm hidden-xs">
					<ul id="top-links">
						<li><a id="menu-about" href="{{ vars.hostname }}/about.php">About</a></li>
						<!--<li><a id="menu-suggest" href="about.php">Suggest Networks</a></li>-->
						{{# logged_in }}
						<li><a href="{{ vars.hostname }}/profile/{{ site_user.id }}" id="welcome">Welcome, {{ site_user.first_name }}</a></li>
						<li><a id="sign-out" href="{{ vars.hostname }}/sign_out.php">Sign Out</a></li>
						{{/ logged_in }}
						{{^ logged_in }}
						<li><a id="login-link" href="#login_modal" data-toggle="modal">Log In</a></li>
						<li><a id="register-link" href="#register_modal" data-toggle="modal">Sign Up</a></li>
						{{/ logged_in }}
					</ul>
				</div>
				<div class="header-mobile-icons hidden-md hidden-lg">
					<div>Search</div>
					<div>Hamburger</div>
				</div>
				<div id="register_modal" class="modal hide fade" tabindex="-1" role="dialog"  aria-labelledby="blogPostLabel" aria-hidden="true">
					<div class="modal-header">
						Join the</br></br><b>CultureMesh Community!</b>
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&#10006</button>
					</div>
					<div class="modal-body">
						<form id="reg_form" method="post" action="{{ vars.hostname }}/r.php">
							<div id="register-div">
								<input type="email" id="reg-email" name="email" placeholder="Email" class="modal-text-input" required /></br>
								</br>
								<input type="text" name="fname" id="fname" class="modal-text-input" placeholder="First Name" required /></br>
								</br>
								<input type="text" name="lname" id="lname" class="modal-text-input" placeholder="Last Name" required /></br>
								</br>
								<span id="email_dup_txt" style="display:none" class="label label-important"></span>
								<div id="login-passwords">
								<input type="password" name="password" id="password" class="modal-text-input-conf" placeholder="Password" onchange="validateInput(this, document.getElementById(\'password_validation\'), 18)" required />
								<input type="password" name="password_conf" id="password_conf" class="modal-text-input-conf" onchange="comparePasswordInput(this, document.getElementById(\'password\'), document.getElementById(\'password_validation\'))"placeholder="Confirm Password" required />
								<div class="clear"></div>
								<span id="password_validation"></span>
								<span id="register_server_error"></span>
								</div>
								</br>
								</br>
								<span id="pass_mism_txt" class="label label-important"></span>
								<div class="clear"></div>
								<input type="hidden" id="reg_joining" name="reg_joining" value="-1" />
								<input type="hidden" id="reg_joining_network" name="reg_joining_network" value="-1" />
								<input type="submit" id="reg_submit_btn" class="submit" data-loading-text="Checking..." value="Join Us" />
							</div>
							<!--
							<div id="register-div">
								<div class='row'>
								<input type="email" id="reg-email" name="email" placeholder="Email" class="modal-text-input" required /></br>
								</div>
								<div class='row'>
								<input type="text" name="fname" id="fname" class="modal-text-input" placeholder="First Name" required /></br>
								</div>
								<div class='row'>
								<input type="text" name="lname" id="lname" class="modal-text-input" placeholder="Last Name" required /></br>
								</div>
								<div class='row'>
								<span id="email_dup_txt" style="display:none" class="label label-important"></span>
								</div>
								<div class='row'>
									<input type="password" name="password" id="password" class="modal-text-input-conf" placeholder="Password" onchange="validateInput(this, document.getElementById(\'password_validation\'), 18)" required />
									<input type="password" name="password_conf" id="password_conf" class="modal-text-input-conf" onchange="comparePasswordInput(this, document.getElementById(\'password\'), document.getElementById(\'password_validation\'))"placeholder="Confirm Password" required />
								</div>
								<div class="clear"></div>
								<span id="password_validation"></span>
								<span id="register_server_error"></span>
								<span id="pass_mism_txt" class="label label-important"></span>
								<div class="clear"></div>
								<input type="submit" id="reg_submit_btn" class="submit" data-loading-text="Checking..." value="Join Us" />
							</div>
							-->
									<!-- REGISTER DIV ARTIFACTS 
								<div id="login-passwords"> 
									<div class='span2'>
									</div>
									<div class='span2'>
									</div>
								</div>
									-->
						</form>
					</div>
					<div class="modal-footer">
						Already a member? <a href="#" onclick="toggleLogin()" id="sign_in_mod">Sign in!</a>
					</div>
				</div>
				<div id="login_modal" class="modal hide fade" tabindex="-1" role="dialog"  aria-labelledby="blogPostLabel" aria-hidden="true">
					<div class="modal-header">
						<b>Welcome Back!</b>
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&#10006</button>
					</div>
					<div class="modal-body">
						<form id="log_form" method="post" action="{{ vars.hostname }}/l.php">
							<div id="login-div">
								<input type="email" name="email" id="log_email" class="modal-text-input" placeholder="Email" required />
								<input type="password" name="password" id="log_password" class="modal-text-input" onchange="validateInput(this, document.getElementById(\'log_validation\'))" placeholder="Password" required />
								</br>
								<span id="log_validation"></span>
								</br>
								</br>
								<input type="submit" id="log_submit_btn" class="submit" data-loading-text="Checking..." value="Sign In" />
								</br>
								</br>
								<a href="{{ vars.hostname }}/forgotpass.php">Forgot your password?</a>
							</div>    
						</form>
					</div>
					<div class="modal-footer">
						Not a member yet? <a href="#" id="sign_in_mod" onclick='toggleRegister()'>Join Us!</a>
					</div>
				</div>
				<div class="clear"></div>
			</div>
			<div id="signout_panel" style="display:none">
				<p>You have successfully signed out.</p>
			</div>
			{{# vars.maintenance.notification }}
			<div id="maintenance-panel">
				<b>Scheduled Maintenance</b>
				<p>CultureMesh is going to undergo scheduled maintenance on {{ vars.maintenance.date }}</p>
				<p>It should last about {{ vars.maintenance.duration }}</p>
			</div>
			{{/ vars.maintenance.notification }}
			{{$ content }}
			{{/ content }}
			<div class="footer row">
			    <ul id="bottom-links" class="text-center hidden-sm hidden-xs">
				    <li><a href="{{ vars.hostname }}/careers.php">Careers</a></li>
				    <li><a href="{{ vars.hostname }}/about.php#team">Team</a></li>
				    <li><a href="{{ vars.hostname }}/press.php">Press</a></li>
				    <li><a href="{{ vars.hostname }}/about.php#contact">Contact</a></li>
			    </ul>
			    <div class="hidden-md hidden-lg">
				    <div class="footer-mobile-share-buttons">
				    </div>
				    <div class="footer-mobile-links">
					    <div><a href="{{ vars.hostname }}/careers.php">Careers</a></div>
					    <div><a href="{{ vars.hostname }}/about.php#team">Team</a></div>
					    <div><a href="{{ vars.hostname }}/press.php">Press</a></div>
					    <div><a href="{{ vars.hostname }}/about.php#contact">Contact</a></div>
				    </div>
				    <div class="footer-mobile-copyright">
					    <p>Copyright 2016 CultureMesh</p>
				    </div>
			    </div>
			</div>
		</div>

		<script>
			function toggleLogin() {
				$("#register_modal").modal('hide');
				$("#login_modal").modal('show');
			}
			function toggleRegister() {
				$("#login_modal").modal('hide');
				$("#register_modal").modal('show');
			}
		</script>
		<script>
		var qs = new QueryStringParser();

		if (qs.qsGet != null) {

			// process login and registration errors

			if (qs.qsGet['lerror'] != undefined) {
				if (qs.qsGet['lerror'] == 'success') {
					$('#signout_panel').children('p').text('You are now logged in!');
					$('#signout_panel').show();
					$('#signout_panel').fadeOut(5000);
				}
				else {
					// call login modal and display error message
					$("#login_modal").modal('show');
					$("#log_validation").html(qs.qsGet['lerror']);
				}
			}
			if (qs.qsGet['rerror'] != undefined) {
				if (qs.qsGet['rerror'] == 'success') {
					$('#signout_panel').children('p').html('You are now registered! Click <a href="{{ vars.hostname }}/profile/{{ site_user.id }}">here</a> to see your profile page.');
					$('#signout_panel').show();
				}
				else {
					// call login modal and display error message
					$("#register_modal").modal('show');
					$("#register_server_error").html(qs.qsGet['rerror']);
				}
			}
		}
		</script>
		{{$ body_scripts }}
		{{/ body_scripts }}
	</body>
</html>
