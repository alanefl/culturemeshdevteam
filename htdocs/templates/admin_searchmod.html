<!-- admin_dbmod.html -->
{{% BLOCKS }}
{{< layout }}>
	{{$ title }}{{page.title}}{{/ title }}

	{{$ more_scripts }}
	<script src='js/spin.js'></script>
	{{/ more_scripts }}
	{{$ content }}

	<script id='single-op-tmpl' type='x-tmpl-mustache'>
	<div id='main-op'>
		<div id='ssearchbar'>
		</div>
		<div id='table'>
		</div>
	</div>
	<div id='side-op'>
		<div id='ssearchbar-alt'>
		</div>
		<div id='table-search'>
		</div>
	</div>
	</script>

	<script id='re-searchable-tmpl' type='x-tmpl-mustache'>
		<!--
		<div id='test'>
			{{ vars.l_brace }}#george{{vars.r_brace}}
			{{ vars.l_brace }}#test{{vars.r_brace}}
			<p>This is a test to see if mustache isn't for dums</p>
			{{ vars.l_brace }}/test{{vars.r_brace}}
			{{ vars.l_brace }}/george{{vars.r_brace}}
		</div>
		-->
		<table id='searchable' class='table'>
			<thead>
			</thead>
			<tfoot>
				<tr>
					{{ vars.l_brace }}#cond.main{{vars.r_brace}}
					<td class='table-send'><button id='sendBtn' class='send'>Send</button></td>
					{{ vars.l_brace }}/cond.main{{vars.r_brace}}
					{{ vars.l_brace }}#cond.alt{{vars.r_brace}}
					<td class='table-fill'><button class='fill'>Fill</button></td>
					{{ vars.l_brace }}/cond.alt{{vars.r_brace}}
				</tr>
			</tfoot>
			<tbody>
				{{ vars.l_brace }}#columns{{vars.r_brace}}
				<tr>
					<td class='db_col'>
						<b>{{ vars.l_brace }}name{{vars.r_brace}}</b>
					</td>
	<!--		-->
	<!-- ROW SECTION -->
	<!--		-->

	<!--
					{{ vars.l_brace }}#colCond.fart{{vars.r_brace}}
					<td class='booger'>
					<p>fart</p>
					</td>	
					{{ vars.l_brace }}/colCond.fart{{vars.r_brace}}
	-->
			<!-- 	 -->
			<!-- UPDATE -->
			<!-- 	 -->
					{{ vars.l_brace }}#colCond.update{{vars.r_brace}}
					<td class='op_val'>
						<span class='on'>{{ vars.l_brace }}value{{vars.r_brace}}</span>
					</td>
					<td class='op_input'>
						<input class='edinput' type='text' name='{{ vars.l_brace }}name{{vars.r_brace}}'>
					</td>
					{{ vars.l_brace }}/colCond.update{{vars.r_brace}}
			<!-- 	 -->
			<!-- DISPLAY -->
			<!-- 	 -->
					{{ vars.l_brace }}#colCond.display{{vars.r_brace}}
					<td class='op_val'>
						<span>{{ vars.l_brace }}value{{vars.r_brace}}</span>
					</td>
					{{ vars.l_brace }}/colCond.display{{vars.r_brace}}
			<!-- 	 -->
			<!-- CREATE -->
			<!-- 	 -->
					{{ vars.l_brace }}#colCond.create{{vars.r_brace}}
					<td class='op_input'>
						<input class='edinput' type='text' name='{{ vars.l_brace }}name{{vars.r_brace}}'>
					</td>
					{{ vars.l_brace }}/colCond.create{{vars.r_brace}}
			<!-- 	 -->
			<!-- SPECIAL #1 -->
			<!-- 	 -->
					{{ vars.l_brace }}#colCond.specone{{vars.r_brace}}
					<td class='op_val'>
						<input type="hidden" name='term-original-string' value="{{ vars.l_brace }}original_string{{vars.r_brace}}" />
						{{ vars.l_brace }}# value{{vars.r_brace}}
						<input class="on term" type="hidden" value="{{ vars.l_brace }} . {{vars.r_brace}}">
						<div class="input-append">
							<input class="on span2" type="text" value="{{ vars.l_brace }} . {{vars.r_brace}}" disabled>
							<button class="btn delete-term" type="button">&#x2716;</button>
						</div>
						{{ vars.l_brace }}/ value{{vars.r_brace}}
						{{ vars.l_brace }}^ value{{vars.r_brace}}
						<input class="on null-term" type="hidden" value="NULL">
						{{ vars.l_brace }}/ value{{vars.r_brace}}
						
					</td>
					{{ vars.l_brace }}/colCond.specone{{vars.r_brace}}
			<!-- 	 -->
			<!-- BOOLEAN -->
			<!-- 	 -->
					{{ vars.l_brace }}#colCond.update_bool{{vars.r_brace}}
					<td class='op_val update_bool'>
						<input type="hidden" name='term-original-string' value="{{ vars.l_brace }}original_string{{vars.r_brace}}" />
						<input type="radio" name='{{ vars.l_brace }} name {{ vars.r_brace }}' value="1" {{ vars.l_brace }}# value {{vars.r_brace}} checked {{ vars.l_brace }}/ value {{vars.r_brace}}>True</input></br>
						<input type="radio" name='{{ vars.l_brace }} name {{ vars.r_brace }}' value="0" {{ vars.l_brace }}^ value {{vars.r_brace}} checked {{ vars.l_brace }}/ value {{vars.r_brace}}>False</input>
					</td>
					{{ vars.l_brace }}/colCond.update_bool{{vars.r_brace}}
	<!--		-->
	<!-- END SECTION -->
	<!--		-->
					<td class='op_action'>
						{{ vars.l_brace }}#colCond.update{{vars.r_brace}}
						<button class='edit-toggle {{ vars.l_brace }}class{{vars.r_brace}}'>Edit</button>
						<button class='submit-edit'>Change</button>
						{{ vars.l_brace }}/colCond.update{{vars.r_brace}}
						{{ vars.l_brace }}#colCond.find{{vars.r_brace}}
						<button class='find'>Find</button>
						{{ vars.l_brace }}/colCond.find{{vars.r_brace}}
						{{ vars.l_brace }}#colCond.specone{{vars.r_brace}}
						<div class="input-append">
							<input class="span2" type="text">
							<button class="btn add-term" type="button">Add Term!</button>
						</div>
						{{ vars.l_brace }}/colCond.specone{{vars.r_brace}}
					</td>
				</tr>
				{{ vars.l_brace }}/columns{{vars.r_brace}}
			</tbody>
		</table>
	</script>

	<script id='create-single-tmpl' type='x-tmpl-mustache'>
	<div id='main-op'>
		<div id='table-div'>
			<table id='insert-table'>
				<thead></thead>
				<tfoot>
					<tr>
						<td><input type='submit' id='send' name='submit' value='Submit'/></td>
					</tr>
				</tfoot>
				<tbody>
					{{ vars.l_brace }}# columns {{ vars.r_brace }}
					<tr>
						<td class='db_col'><b>{{ vars.l_brace }}name{{ vars.r_brace }}</b></td>
						<td class='db_edit {{ vars.l_brace }}colClass{{ vars.r_brace }}'>
							<input type='text' name='input-{{ vars.l_brace }}name{{ vars.r_brace }}'
							{{ vars.l_brace }} validation {{ vars.r_brace }}/>
						</td>
						<td class='db_find {{ vars.l_brace }}colClass{{ vars.r_brace }}'>
							<button class='find'>Find</button>
						</td>
						</td>
					{{ vars.l_brace }}/ columns {{ vars.r_brace }}
				</tbody>
			</table>
		</div>
	</div>
	<div id='side-op'>
		<div id='ssearchbar-extra'>
		</div>
		<div id='table-search-div'>
		</div>
	</div>
	<div class='clear'></div>
	</script>

	<script id='batch-tmpl' type='x-tmpl-mustache'>
		<div id='insert-batch'>
			<form id='insert-val' enctype="multipart/form-data" data-parsley-validate>
				<input id='insert-obj' type='file' name='object' required/>	
				<input type='hidden' name='op' value='ins-parse' />
				<input id='batch-parse' type='submit' value='Parse' />
			</form>
			<form id='insert-form' enctype="multipart/form-data" data-parsley-validate >
				<table id='insert-cols'>
					<thead>
						<tr>Corresponding Columns</tr>
					</thead>
					<tfoot></tfoot>
					<tbody>
					</tbody>
				</table>
				<input type='hidden' name='op' value='ins-send' />
				<input id='send' type='submit' value='Send' />
			</form>
		</div>
	</script>

	<script id='batch-tr' type='x-tmpl-mustache'>
		<tr class='{{ vars.l_brace }} class {{ vars.r_brace }}'>
			<td class='db_col'><b>{{ vars.l_brace }} col {{ vars.r_brace }}</b></td>
			<td class='col_match'>
				<select>
					<option selected='selected'>-</option>
					{{ vars.l_brace }}#vals{{ vars.r_brace }}
					<option>
					{{ vars.l_brace }}.{{ vars.r_brace }}
					</option>
					{{ vars.l_brace }}/vals{{ vars.r_brace }}
				</select>
			</td>
			<td class='update-cb'>
				<input type="checkbox" value="{{ vars.l_brace }} col {{ vars.r_brace }}">Modify?</input>
			</td>
		</tr>
	</script>

	<script id='create-batch-tmpl' type='x-tmpl-mustache'>
		<tr class='{{ vars.l_brace }} class {{ vars.r_brace }}'>
			<td class='db_col'>{{ vars.l_brace }} col {{ vars.r_brace }}</td>
			<td class='col_match'>
				<select>
					<option selected='selected'>-</option>
					{{ vars.l_brace }}#vals{{ vars.r_brace }}
					<option>
					{{ vars.l_brace }}.{{ vars.r_brace }}
					</option>
					{{ vars.l_brace }}/vals{{ vars.r_brace }}
				</select>
			</td>

		</tr>
		<div id='insert-batch'>
			<form id='insert-val' enctype="multipart/form-data" data-parsley-validate>
				<input id='insert-obj' type='file' name='object' required/>	
				<input type='hidden' name='op' value='ins-parse' />
				<input id='insert-parse' type='submit' value='Parse' />
			</form>
			<form id='insert-form' enctype="multipart/form-data" data-parsley-validate >
				<table id='insert-cols'>
					<thead>
						<tr>Corresponding Columns</tr>
					</thead>
					<tfoot><tr><td><button>Add</button</td></tr></tfoot>
					<tbody>
						<tr>
						</tr>
					</tbody>
				</table>
				<input id='insert-send' type='submit' value='Send' />
			</form>
		</div>
	</script>

	<script id='update-single-tmpl' type='x-tmpl-mustache'>
	<div id='main-op'>
		<div id='ssearchbar'>
		</div>
		<div id='table-div'>
		</div>
		<input id='send' type='submit' value='Send' />
	</div>
	<div id='side-op'>
		<div id='ssearchbar-extra'>
		</div>
		<div id='table-search-div'>
		</div>
	</div>
	<div class='clear'></div>

	</script>

	<script id='update-batch-tmpl' type='x-tmpl-mustache'>
	</script>

	<script id='delete-single-tmpl' type='x-tmpl-mustache'>
		<div id='ssearchbar'>
		</div>
		<div id='table-div'>
		</div>

	</script>

	<script id='disp-searchable-tmpl' type='x-tmpl-mustache'>
		<table id='searchable'>
			<thead>
			</thead>
			<tfoot>
				<tr>
					<td></td>
				</tr>
			</tfoot>
			<tbody>
				{{ vars.l_brace }}#columns{{vars.r_brace}}
				<tr>
					<td class='db_col'>
						<b>{{ vars.l_brace }}name{{vars.r_brace}}</b>
					</td>
					<td class='td-edit-value'>
						<span class='on'>{{ vars.l_brace }}value{{vars.r_brace}}</span>
						<input class='edit-input' type='text' name='{{ vars.l_brace }}name{{vars.r_brace}}'>
					</td>
					<td class='td-edit-toggle'>
						<button class='edit-toggle {{ vars.l_brace }}class{{vars.r_brace}}'>Edit</button>
					</td>
					<td class='db_find {{ vars.l_brace }}class{{ vars.r_brace }}'>
						<button class='find'>Find</button>
					</td>
				</tr>
				{{ vars.l_brace }}/columns{{vars.r_brace}}
			</tbody>
		</table>
	</script>

	<script id='single-search-tmpl' type='x-tmpl-mustache'>
			<form id ='search-form' autocomplete='off'>
			<input type='text' id='search-1' class='net-search' name='search-1' autocomplete='off'/>
				<ul id='s-query' class='network search'></ul>
				<ul id='s-var' class='network search'></ul>
				<input type='hidden' id='clik1' name='clik1' value=0></ul>
			<input type='submit' id='search-submit' class='network search-button' value='Go'>
			<input type='hidden' id='search-topic' name='search-topic'></input>
			</form>
	</script>

	<script id='new-term-tmpl' type='x-tmpl-mustache'>
			<input class="on term" type="hidden" value="{{ vars.l_brace }} value {{vars.r_brace}}">
			<div class="input-append">
				<input class="on span2" type="text" value="{{ vars.l_brace }} value {{vars.r_brace}}" disabled>
				<button class="btn delete-term" type="button">&#x2716;</button>
			</div>
	</script>
	<script id='new-null-term-tmpl' type='x-tmpl-mustache'>
			<input class="on null-term" type="hidden" value="NULL">
	</script>

	<div id='kwik-login'>
		<span>What's the password? Huh? <b>Huh?</b></span></br>
		<input id='pass-input' type='password' name='password'/></br>
		<button id='login-button'>Login</button>
		<p id='pass-error-msg'></p>
	</div>
	<div id='activated-panel'>
		<div id='top-stuff'>
			<select id='op-select'>
				<option>-</option>
				<option value='create'>Create</option>
				<option value='update'>Update</option>
			</select>

			<select id='sibat-select'>
				<option>-</option>
				<option value='single'>Single</option>
				<option value='batch'>Batch</option>
			</select>
			<select id='table-select'>
				<option>-<option>
				{{# tables }}<option>{{ . }}<option>{{/ tables }}
			</select>
			</br>
			<button id='commence'>Commence Operation</button>
			<button id='rewrite-txt'>Rewrite Text Files</button>
		</div>
		<div id='op-panel'>
		</div>
		<div id='error-div'>
			<p id='error-msg'></p>
		</div>
		<div id='spin'></div>
	</div>
	<div class='clear'></div>
	{{/ content}}

	{{$ body_scripts }}
	<script src='admin/js/admin_searchmod.js'></script>
	<script src="admin/js/Operation.js"></script>
	<script src='js/ssearchbar.js'></script>
	<!--<script src="admin/js/ModPackage.js"></script>-->
	<script>
		$('#activated-panel').hide();

//		$('#error-msg').text('This is text');

		$('#login-button').on('click', function() {
			
			var value = $('#pass-input').val();
			var post = {
				op : 'login',
				password : value
			}

			var lgin = new Ajax({
				requestType: 'POST',
				requestUrl: 'admin/admin_ops.php',
				requestParameters: ' ',
				data: post,
				dataType: 'JSON',
				sendNow: true
				}, function(data) { 
					
					var result = JSON.parse(data);

					if (result.error == 0) {
						$('#activated-panel').show(500);
						$('#kwik-login').hide();
					}
					else {
						$('#pass-error-msg').show();
						$('#pass-error-msg').text('Sorry, that ain\'t the password');
						$('#pass-error-msg').delay(1000).hide(500);
					}
				});
			});

		$('#rewrite-txt').on('click', function() {
			
			var post = {
				op : 'rewriteTxt',
			}

			// start the nifty spinner-de-thing
			var target = document.getElementById('spin');
			var spinner = new Spinner(opts).spin(target);


			var lgin = new Ajax({
				requestType: 'POST',
				requestUrl: 'admin/admin_ops.php',
				requestParameters: ' ',
				data: post,
				dataType: 'JSON',
				sendNow: true
				}, function(data) { 
					
					// stop the spinner
					spinner.stop();

					var result = JSON.parse(data);

					if (result.error == 0) {
						$('#error-msg').show();
						$('#error-msg').text('Files rewritten');					
						$('#error-msg').delay(1000).hide(500);
					}
					else {
						$('#error-msg').text('Sorry, the files couldn\'t be rewritten');
						$('#error-msg').delay(1000).hide(500);
					}
				});
			});
	</script>
	{{/ body_scripts }}
{{/ layout }}
